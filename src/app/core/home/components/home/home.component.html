<app-navbar-home></app-navbar-home>

<!-- Espaçamento para compensar o navbar fixo -->
<div class="navbar-spacer"></div>

<!-- Banner Promocional Estilo Kabum -->
<section class="promotional-banner" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%) !important;"
  *ngIf="!isLoadingSlides && slides.length > 0">
  <div class="banner-container">
    <div class="banner-content">
      <!-- Lado Esquerdo - Texto e Call-to-Action -->
      <div class="banner-left">
        <div class="banner-text">
          <h1 class="banner-title">{{ slides[currentSlideIndex].titulo }}</h1>
          <h2 class="banner-subtitle">{{ slides[currentSlideIndex].subtitulo }}</h2>
          <button class="cta-button" routerLink="/produtos">
            <span>Garanta agora</span>
            <mat-icon>arrow_forward</mat-icon>
          </button>
        </div>
      </div>

      <!-- Lado Direito - Imagem do Slide -->
      <div class="banner-right">
        <div class="slide-image-container">
          <img [src]="slides[currentSlideIndex].img" [alt]="slides[currentSlideIndex].alt" class="slide-image"
            loading="lazy" (error)="handleImageError($event)">
        </div>
      </div>
    </div>

    <!-- Controles do Banner -->
    <div class="banner-controls" *ngIf="slides.length > 1">
      <button class="control-btn prev-btn" (click)="previousSlide()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button class="control-btn next-btn" (click)="nextSlide()">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>

    <!-- Indicadores -->
    <div class="carousel-indicators" *ngIf="slides.length > 1">
      <button *ngFor="let slide of slides; let i = index" class="indicator" [class.active]="i === currentSlideIndex"
        (click)="goToSlide(i)"></button>
    </div>

    <!-- Botão Pause/Play -->
    <button class="pause-btn" (click)="toggleAutoPlay()" *ngIf="slides.length > 1">
      <mat-icon>{{ isAutoPlayActive ? 'pause' : 'play_arrow' }}</mat-icon>
    </button>
  </div>
</section>

<!-- Loading State para Slides -->
<section class="promotional-banner loading-banner" *ngIf="isLoadingSlides">
  <div class="banner-container">
    <div class="banner-content">
      <div class="banner-left">
        <div class="banner-text">
          <div class="loading-placeholder">
            <div class="skeleton skeleton-title"></div>
            <div class="skeleton skeleton-subtitle"></div>
            <div class="skeleton skeleton-button"></div>
          </div>
        </div>
      </div>
      <div class="banner-right">
        <div class="slide-image-container">
          <div class="skeleton skeleton-image"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CATEGORIAS EM DESTAQUE -->
<section class="categories-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Categorias em Destaque</h2>
      <p class="section-subtitle">Explore nossa variedade de produtos</p>
    </div>

    <div class="categories-grid" *ngIf="!isLoadingCategories; else categoriesLoading">
      <button *ngFor="let cat of categorias; trackBy: trackByCategory" class="category-card"
        [class.active]="cat.id === categoriaSelecionada" (click)="filtrar(cat.id!)"
        [attr.aria-pressed]="cat.id === categoriaSelecionada" [attr.aria-label]="'Filtrar por ' + cat.name">
        <div class="category-icon">
          <mat-icon>{{ cat.icon }}</mat-icon>
        </div>
        <span class="category-name">{{ cat.name }}</span>
      </button>
    </div>

    <ng-template #categoriesLoading>
      <div class="categories-loading">
        <div class="loading-skeleton" *ngFor="let i of [1,2,3,4,5,6]">
          <div class="skeleton-icon"></div>
          <div class="skeleton-name"></div>
        </div>
      </div>
    </ng-template>
  </div>
</section>

<!-- LISTAGEM DE PRODUTOS -->
<section id="produtos" class="products-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Nossos Produtos</h2>
      <p class="section-subtitle">Encontre o que você precisa com qualidade e preço justo</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoadingProducts" class="products-loading">
      <div class="loading-skeleton" *ngFor="let i of [1,2,3,4,5,6,7,8]">
        <div class="skeleton-image"></div>
        <div class="skeleton-content">
          <div class="skeleton-title"></div>
          <div class="skeleton-description"></div>
          <div class="skeleton-price"></div>
          <div class="skeleton-button"></div>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div *ngIf="!isLoadingProducts && produtosFiltrados.length > 0" class="products-grid">
      <div *ngFor="let p of produtosFiltrados; trackBy: trackByProduct" class="product-card" (click)="verDetalhesProduto(p.id)">
        <div class="product-image-container">
          <img [src]="p.img" [alt]="'Imagem do produto ' + p.nome" class="product-image" loading="lazy"
            (error)="handleImageError($event)" />

          <!-- Estrelas de Avaliação -->
          <div class="rating-stars">
            <div class="stars-container">
              <mat-icon *ngFor="let star of [1,2,3,4,5]" class="star-icon" [class.filled]="star <= getProductRating(p)">
                star
              </mat-icon>
              <span class="rating-text">{{ getProductRating(p) }}/5</span>
            </div>
          </div>

          <!-- Overlay com botões de ação (aparece no hover) -->
          <div class="product-overlay">
            <button class="overlay-btn favorite-btn" (click)="toggleFavorito(p); $event.stopPropagation()"
              [class.favorited]="isFavorito(p.id)"
              [matTooltip]="!isUserLoggedIn ? 'Faça login para salvar favoritos' : (isFavorito(p.id) ? 'Remover dos favoritos' : 'Adicionar aos favoritos')">
              <mat-icon>{{ isFavorito(p.id) ? 'favorite' : 'favorite_border' }}</mat-icon>
            </button>
            <button class="overlay-btn cart-btn" (click)="adicionarCarrinho(p); $event.stopPropagation()"
              matTooltip="Adicionar ao carrinho">
              <mat-icon>add_shopping_cart</mat-icon>
            </button>
          </div>

          <div class="product-badge">
            <span class="badge-new">Novo</span>
          </div>
        </div>

        <div class="product-content">
          <h3 class="product-title">{{ p.nome }}</h3>
          <p class="product-description">{{ p.descricao }}</p>
          <div class="product-price">
            <span class="current-price">R$ {{ p.preco | number : "1.2-2" }}</span>
            <span class="original-price">R$ {{ (p.preco * 1.2) | number : "1.2-2" }}</span>
          </div>
          <button class="btn btn-primary w-100" (click)="adicionarCarrinho(p); $event.stopPropagation()">
            <mat-icon>shopping_cart</mat-icon>
            Adicionar ao Carrinho
          </button>
        </div>
      </div>
    </div>

    <!-- No Products Message -->
    <div *ngIf="!isLoadingProducts && produtosFiltrados.length === 0" class="no-products">
      <div class="no-products-content">
        <mat-icon class="no-products-icon">inventory_2</mat-icon>
        <h3>Nenhum produto encontrado</h3>
        <p *ngIf="categoriaSelecionada === 'todos'">Não há produtos disponíveis no momento.</p>
        <p *ngIf="categoriaSelecionada !== 'todos'">Não há produtos nesta categoria.</p>
        <button class="btn btn-primary" (click)="filtrar('todos')" *ngIf="categoriaSelecionada !== 'todos'">
          Ver todos os produtos
        </button>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER SECTION -->
<section class="footer-section">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <h3>VitrineBella</h3>
        <p>Sua loja de confiança para produtos de qualidade com os melhores preços do mercado.</p>
      </div>
      <div class="col-md-6">
        <h4>Contato</h4>
        <p><mat-icon>email</mat-icon> contatovitrinebella.com</p>
        <p><mat-icon>phone</mat-icon> (11) 99999-9999</p>
      </div>
    </div>
  </div>
</section>
