<div class="sidenav-header">
  <!-- Avatar usando imagem ou primeira letra -->
  <div class="avatar-container" [class.collapsed]="sideNavCollapsed()">
    <img *ngIf="userData()?.photoURL" [src]="userData()?.photoURL" [alt]="userData()?.fullName || 'Avatar'"
      class="user-avatar">
    <div *ngIf="!userData()?.photoURL" class="avatar-placeholder" [style.width.px]="profilePicSize()"
      [style.height.px]="profilePicSize()">
      {{ getFirstLetter(userData()?.fullName || 'U') }}
    </div>
  </div>
  <div class="header-text" [class.hide-header-text]="sideNavCollapsed()">
    <h2 class="no-margin">
      {{ userData()?.fullName || "" }}
    </h2>
    <p class="no-margin">
      {{ getTranslatedRole() }}
    </p>
  </div>
</div>

<!-- Botão de navegação entre admin e loja -->
<div *ngIf="hasMultipleRoles()" class="role-toggle-container" [class.collapsed]="sideNavCollapsed()">
  <button mat-raised-button class="role-toggle-btn" [color]="currentRole() === 'admin' ? 'primary' : 'accent'"
    (click)="toggleRole()">
    <mat-icon>{{ currentRole() === 'admin' ? 'store' : 'admin_panel_settings' }}</mat-icon>
    <span *ngIf="!sideNavCollapsed()">
      {{ currentRole() === 'admin' ? 'Ir para Loja' : 'Ir para Admin' }}
    </span>
  </button>
</div>

<mat-nav-list>
  <ng-container *ngFor="let item of filteredMenuItems()">

    <!-- Item de menu com submenu -->
    <div *ngIf="item.children" class="menu-item-container">
      <a mat-list-item class="menu-item expandable" (click)="toggleMenuExpansion(item, $event)">
        <mat-icon matListItemIcon aria-hidden="false">{{ item.icon }}</mat-icon>
        <span matListItemTitle *ngIf="!sideNavCollapsed()">{{ item.label }}</span>

        <!-- Badge de notificação para produtos com estoque baixo -->
        <span *ngIf="item.label === 'Gerenciar Produtos' && lowStockCount() > 0 && !sideNavCollapsed()"
          class="stock-notification-badge">
          {{ lowStockCount() }}
        </span>

        <!-- Ícone de notificação quando collapsed -->
        <mat-icon *ngIf="item.label === 'Gerenciar Produtos' && lowStockCount() > 0 && sideNavCollapsed()"
          class="notification-icon" matTooltip="{{ lowStockCount() }} produto(s) com estoque baixo" aria-hidden="false">
          notifications_active
        </mat-icon>

        <!-- Ícone de expansão -->
        <mat-icon *ngIf="!sideNavCollapsed()" matListItemIcon class="expand-icon" [class.expanded]="item.expanded"
          aria-hidden="false">
          keyboard_arrow_down
        </mat-icon>

      </a>

      <!-- Submenu -->
      <div *ngIf="item.expanded && !sideNavCollapsed()" class="submenu">
        <a mat-list-item class="submenu-item" *ngFor="let child of item.children" [routerLink]="child.route"
          routerLinkActive="selected-menu-item" #rla="routerLinkActive" [activated]="rla.isActive"
          (click)="preventDefault($event)">
          <mat-icon matListItemIcon aria-hidden="false">{{ child.icon }}</mat-icon>
          <span matListItemTitle>{{ child.label }}</span>
        </a>
      </div>
    </div>

    <!-- Item de menu simples -->
    <a *ngIf="!item.children" mat-list-item class="menu-item" [routerLink]="item.route"
      routerLinkActive="selected-menu-item" #rla="routerLinkActive" [activated]="rla.isActive"
      (click)="preventDefault($event)">
      <mat-icon matListItemIcon aria-hidden="false">{{ item.icon }}</mat-icon>
      <span matListItemTitle *ngIf="!sideNavCollapsed()">{{ item.label }}</span>
    </a>

  </ng-container>
</mat-nav-list>

<!-- Ações inferiores: Perfil e Sair lado a lado -->
<div class="bottom-actions" [class.sidenav-collapsed]="sideNavCollapsed()">
  <button mat-button class="logout-button" (click)="logout()">
    <mat-icon>logout</mat-icon>
    <span *ngIf="!sideNavCollapsed()">Sair</span>
  </button>
</div>
