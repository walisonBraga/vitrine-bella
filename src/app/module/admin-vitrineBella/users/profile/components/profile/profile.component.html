<app-navigation-admin>
  <!-- Conteúdo principal -->
  <div class="profile-container">
    <!-- Header MEUS DADOS -->
    <div class="page-header">
      <h1>
        <mat-icon>person</mat-icon>
        MEUS DADOS
      </h1>
    </div>

    <!-- Card principal -->
    <div class="profile-card">
      <form [formGroup]="editForm" (ngSubmit)="onSaveEdit()">
        <!-- Seção principal com foto e campos -->
        <div class="main-section">
          <!-- Foto do lado esquerdo -->
          <div class="photo-section">
            <div class="photo-container">
              <app-avatar
                [name]="userData?.fullName || 'Usuário'"
                [photoUrl]="previewUrl || userData?.photoURL"
                [size]="120"
                [showBorder]="true">
              </app-avatar>
              <button type="button" class="change-photo-btn" (click)="fileInput.click()" [disabled]="photoUploading">
                <mat-spinner *ngIf="photoUploading" diameter="16"></mat-spinner>
                <mat-icon *ngIf="!photoUploading">camera_alt</mat-icon>
                {{ photoUploading ? 'Enviando...' : 'Alterar foto' }}
              </button>

              <!-- Indicador de foto selecionada -->
              <div class="photo-selected-indicator" *ngIf="selectedFile && !photoUploading">
                <mat-icon>check_circle</mat-icon>
                <span>Foto selecionada</span>
              </div>

              <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none" />
            </div>
          </div>

          <!-- Campos do lado direito -->
          <div class="fields-section">
            <!-- E-mail -->
            <div class="form-field">
              <label>E-mail</label>
              <div class="input-container readonly">
                <input type="email" [value]="userData?.email || ''" readonly />
                <mat-icon class="lock-icon">lock</mat-icon>
              </div>
              <a href="#" class="change-link">ALTERAR E-MAIL</a>
            </div>

            <!-- CPF e Data de nascimento lado a lado -->
            <div class="form-row">
              <div class="form-field">
                <label>CPF</label>
                <div class="input-container readonly">
                  <input type="text" [value]="userData?.cpf || 'Não informado'" readonly />
                  <mat-icon class="lock-icon">lock</mat-icon>
                </div>
              </div>

              <div class="form-field">
                <label>Data de nascimento</label>
                <div class="input-container readonly">
                  <input type="text" [value]="formatBirthDate(userData?.birthDate)" readonly />
                  <mat-icon class="lock-icon">lock</mat-icon>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Nome completo e Telefone lado a lado -->
        <div class="form-row">
          <div class="form-field">
            <label>Nome completo*</label>
            <div class="input-container">
              <input matInput formControlName="fullName" placeholder="Digite seu nome completo" />
            </div>
            <div class="required-note">(*) Campos obrigatórios</div>
          </div>

          <div class="form-field">
            <label>Telefone celular*</label>
            <div class="input-container">
              <input matInput formControlName="phone" placeholder="(00) 00000-0000" mask="(00) 00000-0000" />
            </div>
          </div>
        </div>

        <!-- Checkbox de marketing -->
        <div class="checkbox-field">
          <mat-checkbox formControlName="marketing" checked>
            Quero receber ofertas e novidades por e-mail, SMS, WhatsApp ou mensagens nos Apps's KaBuM
          </mat-checkbox>
        </div>

        <!-- Botões de ação -->
        <div class="action-buttons">
          <div class="left-actions">
            <a href="#" class="change-link" (click)="onTogglePassword(); $event.preventDefault()">
              ALTERAR SENHA
            </a>
            <a href="#" class="delete-link" (click)="onDeleteAccount(); $event.preventDefault()">
              <mat-icon>delete</mat-icon>
              EXCLUIR MINHA CONTA
            </a>
          </div>
          <button mat-raised-button type="submit" class="save-button" [disabled]="loading || editForm.invalid">
            {{ loading ? "SALVANDO..." : "SALVAR ALTERAÇÕES" }}
          </button>
        </div>
      </form>
    </div>

    <!-- Modal de alteração de senha -->
    <div class="password-modal" *ngIf="passwordMode">
      <div class="modal-overlay" (click)="onTogglePassword()"></div>
      <div class="modal-content">
        <h2>Alterar Senha</h2>
        <form [formGroup]="passwordForm" (ngSubmit)="onSavePassword()">
          <mat-form-field appearance="outline">
            <mat-label>Senha Atual</mat-label>
            <input matInput formControlName="currentPassword" type="password" />
            <mat-error>Senha obrigatória</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Nova Senha</mat-label>
            <input matInput formControlName="newPassword" type="password" />
            <mat-error>Mínimo 8 caracteres</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Confirmar Senha</mat-label>
            <input matInput formControlName="confirmPassword" type="password" />
            <mat-error *ngIf="confirmPassword?.invalid">Confirmação obrigatória</mat-error>
            <mat-error *ngIf="passwordForm.hasError('mismatch')">Senhas não coincidem</mat-error>
          </mat-form-field>

          <div class="modal-buttons">
            <button mat-button type="button" (click)="onTogglePassword()">
              Cancelar
            </button>
            <button mat-raised-button color="primary" type="submit" [disabled]="loading || passwordForm.invalid">
              {{ loading ? "Alterando..." : "Alterar Senha" }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</app-navigation-admin>
