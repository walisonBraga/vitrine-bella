<div class="slide-modal">
  <div class="modal-header">
    <h2 mat-dialog-title>
      <mat-icon>{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
      {{ isEditMode ? 'Editar Slide' : 'Criar Novo Slide' }}
    </h2>
    <button mat-icon-button (click)="onCancel()" class="close-btn">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content class="modal-content">
    <form [formGroup]="slideForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Título</mat-label>
          <input matInput formControlName="titulo" placeholder="Ex: Lançamentos Imperdíveis">
          <mat-error>{{ getErrorMessage('titulo') }}</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Subtítulo</mat-label>
          <textarea matInput formControlName="subtitulo" rows="3"
            placeholder="Ex: Smartphones e notebooks com até 30% OFF"></textarea>
          <mat-error>{{ getErrorMessage('subtitulo') }}</mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <div class="file-upload-container">
          <button mat-raised-button type="button" (click)="fileInput.click()" color="primary" class="choose-file-btn">
            <mat-icon>photo_camera</mat-icon>
            {{ selectedFile ? 'Trocar Imagem' : 'Escolher Foto' }}
          </button>
          <input type="file" accept="image/*" (change)="onFileSelected($event)" #fileInput hidden>

          <button mat-icon-button type="button" (click)="removeImage()" *ngIf="selectedFile || previewImage" class="remove-image-btn">
            <mat-icon>delete</mat-icon>
          </button>

          <div class="file-info" *ngIf="selectedFile">
            <p><strong>Arquivo selecionado:</strong> {{ selectedFile.name }}</p>
            <p><strong>Tamanho:</strong> {{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</p>
          </div>

          <p class="file-info">Formatos aceitos: JPG, PNG, GIF, WebP (máx. 5MB)</p>
        </div>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Texto Alternativo</mat-label>
          <input matInput formControlName="alt" placeholder="Descrição da imagem para acessibilidade">
          <mat-error>{{ getErrorMessage('alt') }}</mat-error>
        </mat-form-field>
      </div>


      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Ordem</mat-label>
          <input matInput type="number" formControlName="ordem" min="1">
          <mat-error>{{ getErrorMessage('ordem') }}</mat-error>
        </mat-form-field>

        <div class="toggle-container">
          <mat-slide-toggle formControlName="ativo" color="primary">
            Slide Ativo
          </mat-slide-toggle>
        </div>
      </div>

      <!-- Preview da Imagem -->
      <div class="image-preview" *ngIf="previewImage">
        <h3>Preview da Imagem:</h3>
        <div class="preview-container">
          <img [src]="previewImage" [alt]="slideForm.get('alt')?.value" class="preview-image"
            (error)="previewImage = null">
        </div>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="modal-actions">
    <button mat-button (click)="onCancel()" [disabled]="isLoading">
      <mat-icon>cancel</mat-icon>
      Cancelar
    </button>
    <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="slideForm.invalid || isLoading">
      <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
      {{ isLoading ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Criar') }}
    </button>
  </mat-dialog-actions>
</div>
